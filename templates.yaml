- binary_sensor:
    - name: Pralka pralnia
      unique_id: pralka_pralnia
      icon: mdi:washing-machine
      state: "{{ states('sensor.power_washing_machine_pralnia') | int > 1 }}"
      availability: "{{ is_number(states('sensor.power_washing_machine_pralnia')) }}"

    - name: Zmywarka kuchnia
      unique_id: zmywarka_kuchnia
      icon: mdi:dishwasher
      state: "{{ states('sensor.power_dishwasher_kuchnia') | int > 1 }}"
      availability: "{{ is_number(states('sensor.power_dishwasher_kuchnia')) }}"

- trigger:
    - platform: state
      entity_id: weather.lowicz
  action:
    - service: weather.get_forecasts
      target:
        entity_id: weather.lowicz
      data:
        type: daily
      response_variable: daily_forecast
  sensor:
    - name: Pomocnik prognozy pogody
      unique_id: accuweather_forecast_daily_helper
      state: "{{ now().isoformat() }}"
      attributes:                                           
        forecast: "{{ daily_forecast['weather.lowicz'].forecast }}"
    - name: Dom Prawdopodobieństwo opadów
      unique_id: home_precipitation_probablility
      icon: mdi:weather-partly-rainy
      unit_of_measurement: "%"
      state_class: measurement
      state: "{{ daily_forecast['weather.lowicz'].forecast[0].precipitation_probability }}"

- trigger:
    - trigger: state
      entity_id: weather.lowicz
  action:
    - action: ai_task.generate_data
      data:
        entity_id: ai_task.google_ai_task
        task_name: Opis pogody
        instructions: >-
          Na podstawie: {{ states.weather.dom }} i {{ states.sensor.dom_prawdopodobienstwo_opadow }} 
          opisz warunki pogodowe w jednym zdaniu, bez podawania wartości liczbowych.

          1. Zachmurzenie:
            - "partlycloudy" → częściowe zachmurzenie
            - "cloudy", windy-variant → duże zachmurzenie
            - inne → opisz wprost (np. pochmurno, burzowo, bezchmurnie)

          2. Temperatura:
            - ≤-3°C → bardzo zimno
            - -2–8°C → zimno
            - 9–18°C → chłodno
            - 19–25°C → ciepło
            - 26–30°C → bardzo ciepło
            - >30°C → gorąco

          3. Wiatr:
            - 0–2 km/h → bezwietrznie
            - 3–15 km/h → słaby wiatr
            - 16–30 km/h → umiarkowany wiatr
            - 31–50 km/h → silny wiatr
            - >50 km/h → porywisty wiatr

          4. Wilgotność:
            - Podaj tylko, jeśli >70% i nie pada deszcz i opisz jako "jest wilgotno", "wigotność jest wysoka".

          5. Prawdopodobieństwo opadów:
            - Sensor zwraca wartość procentową, stan 1 oznacza 1% prawdopodobieństwa.
            - 0–20% → niskie
            - 21–50% → umiarkowane
            - 51–80% → wysokie
            - 81–100% → bardzo wysokie

          6. Zasady językowe:
            - Zamiast „ciepła pogoda” podaj „jest ciepło”.
            - Nie używaj określeń: „jest umiarkowanie”, „temperatura jest łagodna”, „wiatr jest bezwietrznie”.

          7. Format zdania:
            - Kolejność: zachmurzenie/warunki → temperatura → wilgotność → wiatr → prawdopodobieństwo opadów.
            - Pomijaj informacje o temeraturze odczuwalnej.
            - Styl: krótki, rzeczowy, bez ozdobników.

          Przykłady:
          - "Jest słonecznie i bezchmurnie, jest ciepło, wieje słaby wiatr z umiarkowanymi porywami, a prawdopodobieństwo opadów jest niskie."
          - "Jest gorąco, wieje słaby wiatr, zachmurzenie jest częściowe, a prawdopodobieństwo opadów jest wysokie."
          - "Pada deszcz i jest zimno, wieje silny wiatr i zachmurzenie jest duże."
          - "Jest częściowe zachmurzenie, jest chłodno i wilgotno, wieje słaby wiatr, a prawdopodobieństwo opadów jest niskie."
      response_variable: weather_description
  sensor:
    - name: Opis pogody
      unique_id: weather_description
      state: "{% if weather_description is defined %}{{ weather_description.data }}{% endif %}"
