- id: ios_turn_on_tv
  alias: Włącz telewizję w salonie
  description: ''
  triggers:
  - event_type: ios.action_fired
    event_data:
      actionName: Turn On TV
    trigger: event
  actions:
  - action: script.alexa_harmony_activity_tv
    metadata: {}
    data: {}
- id: ios_turn_off_tv
  alias: Wyłącz sprzęt RTV w salonie
  description: ''
  triggers:
  - event_type: ios.action_fired
    event_data:
      actionName: Turn Off TV
    trigger: event
  actions:
  - action: script.alexa_harmony_power_off
    metadata: {}
    data: {}
- id: notification_high_ram_usage
  alias: Wysokie użycie pamięci RAM
  description: ''
  triggers:
  - entity_id:
    - sensor.intel_nuc_uzycie_pamieci
    above: 70
    for:
      minutes: 5
    trigger: numeric_state
  actions:
  - data:
      title: Wysokie użycie pamięci RAM
      message: Serwer Home Assistant używa obecnie {{ trigger.to_state.state }}% pamięci
        RAM.
      tag: high-ram-usage
      group: server
      priority: high
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
- id: notification_storm_comming
  alias: Burza w pobliżu
  description: ''
  triggers:
  - entity_id:
    - sensor.dom_dystans_do_blyskawicy
    below: 10
    trigger: numeric_state
  conditions:
  - condition: template
    value_template: '{{ now().timestamp() - as_timestamp(this.attributes.last_triggered,
      0) > 480 }}'
  actions:
  - parallel:
    - if:
      - condition: state
        entity_id: person.maciek
        state: home
      then:
        data:
          title: '{{ notification_title }}'
          message: '{{ notification_message }}'
          tag: '{{ notification_tag }}'
          services:
          - service: notify.mobile_app_iphone_13
            type: ios
        action: python_script.notify
    - if:
      - condition: state
        entity_id: person.edyta
        state: home
      then:
        data:
          title: '{{ notification_title }}'
          message: '{{ notification_message }}'
          tag: '{{ notification_tag }}'
          services:
          - service: notify.mobile_app_iphone_12
            type: ios
        action: python_script.notify
  variables:
    notification_title: Burza w pobliżu domu
    notification_message: Wyładowania atmosferyczne występują {{ states('sensor.dom_dystans_do_blyskawicy')
      }} km od domu.
    notification_tag: storm-comming
- id: notification_dishwasher_end
  alias: Koniec zmywania naczyń
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.zmywarka_kuchnia
    from: 'on'
    to: 'off'
    for:
      minutes: 1
    trigger: state
  actions:
  - parallel:
    - if:
      - condition: state
        entity_id: person.maciek
        state: home
      then:
      - data:
          title: Koniec zmywania
          message: Zmywarka zakończyła zmywanie naczyń.
          tag: dishwasher
          group: home
          services:
          - service: notify.mobile_app_iphone_13
            type: ios
        action: python_script.notify
    - if:
      - condition: state
        entity_id: person.edyta
        state: home
      then:
      - data:
          title: Koniec zmywania
          message: Zmywarka zakończyła zmywanie naczyń.
          tag: dishwasher
          group: home
          services:
          - service: notify.mobile_app_iphone_12
            type: ios
        action: python_script.notify
- id: notification_salon_co2
  alias: Wysokie stężenie dwutlenku węgla w salonie
  description: ''
  triggers:
  - entity_id: sensor.co2_salon
    above: 1000
    for:
      minutes: 5
    trigger: numeric_state
  conditions: []
  actions:
  - parallel:
    - choose:
        conditions:
          condition: state
          entity_id: person.maciek
          state: home
        sequence:
          data:
            title: '{{ notification_title }}'
            message: '{{ notification_message }}'
            tag: '{{ notification_tag }}'
            services:
            - service: notify.mobile_app_iphone_13
              type: ios
          action: python_script.notify
    - choose:
        conditions:
          condition: state
          entity_id: person.edyta
          state: home
        sequence:
          data:
            title: '{{ notification_title }}'
            message: '{{ notification_message }}'
            tag: '{{ notification_tag }}'
            services:
            - service: notify.mobile_app_iphone_12
              type: ios
          action: python_script.notify
  variables:
    notification_title: Wysokie stężenie dwutlenku węgla
    notification_message: W salonie stężenie dwutlenku węgla wynosi {{ trigger.to_state.state
      }} ppm. Należy przewietrzyć pomieszczenie.
    notification_tag: high-co2-level
- id: notification_water_leak_kuchnia
  alias: Wyciek wody
  description: ''
  triggers:
  - entity_id: binary_sensor.water_leak_pralnia
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id: binary_sensor.water_leak_lazienka
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.wyciek_wody_w_kuchni
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - data:
      title: '{{ notification_title }}'
      message: '{{ notification_message }}'
      tag: water-leak-{{ area_name(trigger.entity_id) }}
      priority: high
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
      - service: notify.mobile_app_iphone_12
        type: ios
    action: python_script.notify
  variables:
    notification_title: Wykryto wyciek wody
    notification_message: 'Wykryto wyciek wody w pomieszczeniu: {{ area_name(trigger.entity_id).lower()
      }}.'
- id: notification_relay_overpower
  alias: Przeciążenie przekaźnika
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.shelly_plus_plug_s_2ffb28_overpower
    - binary_sensor.shelly_plus_plug_s_d00c84_overpower
    - binary_sensor.shelly_plus_1pm_948ff8_overpower
    - binary_sensor.shelly_plus_1pm_b22864_overpower
    - binary_sensor.shelly_1pm_mini_gen3_411170_overpowering
    - binary_sensor.shelly_plus_1pm_9d35dc_overpowering
    - binary_sensor.oswietlenie_lozka_w_sypialni_przeciazenie
    - binary_sensor.oswietlenie_sypialni_przeciazenie
    - binary_sensor.oswietlenie_lazienki_przeciazenie
    - binary_sensor.oswietlenie_garderoby_przeciazenie
    - binary_sensor.shelly_pro_1pm_80e0c0_overpower
    - binary_sensor.oswietlenie_pralnia_przeciazenie
    - binary_sensor.oswietlenie_gabinet_przeciazenie
    - binary_sensor.oswietlenie_toaleta_przeciazenie
    - binary_sensor.oswietlenie_antek_przeciazenie
    - binary_sensor.ledy_w_salonie_przeciazenie
    - binary_sensor.wentylator_i_oswietlenie_w_salonie_przeciazenie
    from: 'off'
    to: 'on'
    for:
      minutes: 1
    trigger: state
  actions:
  - data:
      title: '{{ notification_title }}'
      message: '{{ notification_message }}'
      tag: relay-overpower-{{ trigger.entity_id }}
      priority: high
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
  variables:
    notification_title: Zbyt duże obciążenie przekaźnika
    notification_message: Przekaźnik urządzenia {{ device_name(trigger.entity_id)
      }} ma zbyt duże obciążenie i został wyłączony.
- id: notification_relay_overheating
  alias: Przegrzanie przekaźnika
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.shelly_plus_plug_s_2ffb28_overtemperature
    - binary_sensor.shelly_plus_plug_s_d00c84_overtemperature
    - binary_sensor.shelly_plus_1pm_948ff8_overtemperature
    - binary_sensor.shelly_plus_1pm_b22864_overtemperature
    - binary_sensor.shelly_1pm_mini_gen3_411170_overheating
    - binary_sensor.shelly_plus_1pm_9d35dc_overheating
    - binary_sensor.oswietlenie_lozka_w_sypialni_przegrzewanie
    - binary_sensor.oswietlenie_sypialni_przegrzewanie
    - binary_sensor.oswietlenie_garderoby_przegrzewanie
    - binary_sensor.shelly_pro_1pm_80e0c0_overtemperature
    - binary_sensor.oswietlenie_pralnia_przegrzewanie
    - binary_sensor.oswietlenie_gabinet_przegrzewanie
    - binary_sensor.oswietlenie_toaleta_przegrzewanie
    - binary_sensor.oswietlenie_antek_przegrzewanie
    - binary_sensor.ledy_w_salonie_przegrzewanie
    - binary_sensor.wentylator_i_oswietlenie_w_salonie_przegrzewanie
    - binary_sensor.oswietlenie_lazienki_przegrzewanie
    from: 'off'
    to: 'on'
    for:
      minutes: 1
    trigger: state
  actions:
  - data:
      title: '{{ notification_title }}'
      message: '{{ notification_message }}'
      tag: relay-overheating-{{ trigger.entity_id }}
      priority: high
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
  variables:
    notification_title: Urządzenie się przegrzewa
    notification_message: Urządzenie {{ device_name(trigger.entity_id) }} się przegrzewa.
- id: notification_motion_when_away_mode
  alias: Ruch w pustym mieszkaniu
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.motion_antek
    - binary_sensor.motion_antresola
    - binary_sensor.motion_gabinet
    - binary_sensor.motion_goscinny
    - binary_sensor.ruch_korytarz
    - binary_sensor.motion_kuchnia
    - binary_sensor.motion_lazienka
    - binary_sensor.motion_pracownia
    - binary_sensor.motion_przedpokoj
    - binary_sensor.motion_salon
    - binary_sensor.motion_schody
    - binary_sensor.motion_sypialnia
    - binary_sensor.motion_toaleta
    - binary_sensor.motion_pralnia
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'on'
    for:
      minutes: 10
  actions:
  - variables:
      area: '{% set area = area_name(trigger.entity_id) %}{{ area[0] | lower + area[1:]
        }}'
      snapshot_name: '{{ now().strftime(''%Y%m%d_%H%M%S'') }}.jpg'
      snapshot_areas:
      - salon
      - kuchnia
      - przedpokój
  - if:
    - condition: template
      value_template: '{{ area in snapshot_areas }}'
    then:
    - data:
        filename: /media/salon/{{ snapshot_name }}
      target:
        entity_id: camera.salon
      action: camera.snapshot
  - data:
      title: Wykryto ruch w pustym mieszkaniu
      message: 'Pomieszczenie: {{ area }}, godzina {{ now().strftime(''%H:%M'') }}.'
      tag: motion-{{ area }}
      group: motion
      image: "{% if area in snapshot_areas %}\n  /media/local/salon/{{ snapshot_name
        }}\n{% endif %}"
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
      - service: notify.mobile_app_iphone_12
        type: ios
    action: python_script.notify
- id: notification_window_opened_when_away_mode
  alias: Otwarcie okna w pustym mieszkaniu
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.balcony_door_pracownia
    - binary_sensor.balcony_door_sypialnia
    - binary_sensor.window_antek
    - binary_sensor.window_gabinet
    - binary_sensor.window_goscinny
    - binary_sensor.window_kuchnia
    - binary_sensor.window_sypialnia
    - binary_sensor.windows_antresola
    - binary_sensor.windows_salon
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'on'
    for:
      minutes: 10
  actions:
  - data:
      title: Wykryto otwarcie okna w pustym mieszkaniu
      message: 'Pomieszczenie: {{ area_name(trigger.entity_id).lower() }}, godzina
        {{ now().strftime(''%H:%M'') }}.'
      tag: window-opened-{{ area_name(trigger.entity_id) }}
      group: windows
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
      - service: notify.mobile_app_iphone_12
        type: ios
    action: python_script.notify
- id: notification_balcony_door_pracownia_opened
  alias: Drzwi balkonowe w pracowni otwarte
  description: ''
  triggers:
  - entity_id: binary_sensor.people_at_home
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.balcony_door_pracownia
    state: 'on'
  actions:
  - data:
      title: Otwarte drzwi balkonowe
      message: Domownicy opuścili mieszkanie, a drzwi balkonowe w pracowni nie są
        zamknięte.
      tag: balcony-door-pracownia
      priority: high
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
      - service: notify.mobile_app_iphone_12
        type: ios
    action: python_script.notify
- id: notification_gas_leak_kuchnia
  alias: Wyciek gazu w kuchni
  description: ''
  triggers:
  - entity_id: binary_sensor.gas_leak_kuchnia
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - parallel:
    - data:
        title: Wyciek gazu
        message: Uwaga! Wykryto wyciek gazu w kuchni!
        tag: gas-leak
        priority: high
        services:
        - service: notify.mobile_app_iphone_13
          type: ios
        - service: notify.mobile_app_iphone_12
          type: ios
        - service: notify.mobile_app_iphone_15_pro
          type: ios
      action: python_script.notify
    - if:
      - condition: state
        entity_id: script.devices_away_mode
        state: 'off'
      then:
      - data:
          gw_mac: f0b429cc6f0b
          ringtone_id: 2
          ringtone_vol: 20
        action: xiaomi_aqara.play_ringtone
      - delay: 00:00:05
      - data:
          gw_mac: f0b429cc6f0b
          ringtone_id: 2
          ringtone_vol: 20
        action: xiaomi_aqara.play_ringtone
- id: notification_low_battery
  alias: Niski poziom naładowania baterii
  description: ''
  triggers:
  - at: '18:00:00'
    trigger: time
  conditions:
  - condition: template
    value_template: "{% macro battery_level() %}\n  {% for item in states.sensor if
      item.attributes.device_class == 'battery' and item.attributes.unit_of_measurement
      == '%' and item.state != \"unavailable\" and item.state | int(-1) < threshold
      %}\n    {{ item.entity_id }}\n  {% endfor %}\n{% endmacro %} {{ battery_level()
      | trim != '' }}\n"
  actions:
  - data:
      title: Niski poziom naładowania baterii
      message: "{% macro battery_level() %}{% for item in states.sensor if item.attributes.device_class
        == 'battery' and item.attributes.unit_of_measurement == '%' and item.state
        | int(0) < threshold %}\n - {{ device_name(item.entity_id) }}{% if area_name(item.entity_id)
        %}, {{ area_name(item.entity_id) }}{% endif %}, {{ item.state | round(0, default='unknown')
        }}%{% endfor %}{% endmacro %}W następujących urządzeniach jest niski poziom
        naładowania baterii: {{ battery_level() }}"
      tag: low-battery
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
  variables:
    threshold: 20
- id: presence_peoples_away
  alias: Domownicy poza domem
  description: ''
  triggers:
  - entity_id: binary_sensor.people_at_home
    to: 'off'
    trigger: state
  actions:
  - entity_id: input_boolean.away_mode
    action: input_boolean.turn_on
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.windows_antresola
        state: 'on'
      - condition: state
        entity_id: binary_sensor.window_gabinet
        state: 'on'
      - condition: state
        entity_id: binary_sensor.window_antek
        state: 'on'
      - condition: state
        entity_id: binary_sensor.windows_sypialnia
        state: 'on'
    - condition: numeric_state
      entity_id: sensor.dom_prawdopodobienstwo_opadow
      above: 20
    then:
    - data:
        title: Otwarte okna
        message: Okna na piętrze nie są zamknięte, a prawdopodobieństwo opadów wynosi
          {{ states('sensor.dom_prawdopodobienstwo_opadow') | int }}%.
        tag: windows-weather
        group: windows
        priority: high
        services:
        - service: notify.mobile_app_iphone_13
          type: ios
        - service: notify.mobile_app_iphone_12
          type: ios
      action: python_script.notify
- id: presence_peoples_back
  alias: Domownicy w domu
  description: ''
  triggers:
  - entity_id: binary_sensor.people_at_home
    to: 'on'
    trigger: state
  actions:
  - entity_id: input_boolean.away_mode
    action: input_boolean.turn_off
  - if:
    - condition: sun
      after: sunset
    then:
    - target:
        entity_id: light.leds_schody
      data: {}
      action: light.turn_on
- id: heating_day
  alias: Tryb dzienny ogrzewania
  description: ''
  triggers:
  - entity_id:
    - schedule.heating
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  - condition: state
    entity_id: binary_sensor.windows
    state: 'off'
  actions:
  - data: {}
    action: script.heating_day
- id: heating_night
  alias: Tryb nocny ogrzewania
  description: ''
  triggers:
  - entity_id:
    - schedule.heating
    from: 'on'
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  - condition: state
    entity_id: binary_sensor.windows
    state: 'off'
  actions:
  - data: {}
    action: script.heating_night
- id: turn_off_ceiling_fan_for_night
  alias: Wyłącz wentylator w salonie na noc
  description: ''
  triggers:
  - entity_id: light.ceiling_salon
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: fan.ceiling_salon
    state: 'on'
  - condition: state
    entity_id: media_player.philips_65oled707
    state: 'off'
  actions:
  - entity_id: fan.ceiling_salon
    action: fan.turn_off
- id: heating_away_mode
  alias: Tryb "poza domem" ogrzewania
  description: ''
  triggers:
  - entity_id: input_boolean.away_mode
    from: 'off'
    to: 'on'
    for:
      minutes: 10
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: state
    entity_id: input_boolean.heating_airing
    state: 'off'
  actions:
  - data: {}
    action: script.heating_away_mode
- id: heating_peoples_back
  alias: Powrót domowników do domu
  description: ''
  triggers:
  - entity_id: input_boolean.away_mode
    from: 'on'
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: state
    entity_id: input_boolean.heating_airing
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.heating
        state: 'on'
      sequence:
        data: {}
        action: script.heating_day
    default:
      data: {}
      action: script.heating_night
- id: windows_opened
  alias: Okna otwarte
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.windows
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 30
      seconds: 0
    trigger: state
  actions:
  - entity_id: fan.oczyszczacz_powietrza_salon
    action: fan.turn_off
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - entity_id: input_boolean.heating_airing
    action: input_boolean.turn_on
- id: windows_closed
  alias: Okna zamknięte
  description: ''
  triggers:
  - entity_id: binary_sensor.windows
    from: 'on'
    to: 'off'
    for:
      minutes: 5
    trigger: state
  actions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - entity_id: input_boolean.heating_airing
    action: input_boolean.turn_off
- id: air_quality_turn_on_air_purifier
  alias: Rozpoczęcie oczyszczania powietrza w salonie
  description: ''
  triggers:
  - entity_id: sensor.xiaomi_mi_air_purifier_3h_pm2_5
    above: 50
    for:
      minutes: 2
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: binary_sensor.windows
    state: 'off'
  actions:
  - entity_id: fan.oczyszczacz_powietrza_salon
    data:
      percentage: "{% if states('sensor.xiaomi_mi_air_purifier_3h_pm2_5') | int(0)
        > 100 %}\n  66\n{% else %}\n  33\n{% endif %}"
    action: fan.turn_on
- id: air_quality_turn_off_air_purifier
  alias: Zakończenie oczyszczania powietrza w salonie
  description: ''
  triggers:
  - entity_id: sensor.xiaomi_mi_air_purifier_3h_pm2_5
    below: 50
    for:
      minutes: 2
    trigger: numeric_state
  actions:
  - entity_id: fan.oczyszczacz_powietrza_salon
    action: fan.turn_off
- id: air_quality_air_purifier_switch_fan_level_to_2
  alias: Zmiana prędkości oczyszczacza na 2
  description: ''
  triggers:
  - entity_id: sensor.xiaomi_mi_air_purifier_3h_pm2_5
    above: 100
    for:
      minutes: 2
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: fan.oczyszczacz_powietrza_salon
    state: 'on'
  - condition: numeric_state
    entity_id: number.xiaomi_mi_air_purifier_3h_fan_level
    below: 2
  actions:
  - entity_id: number.xiaomi_mi_air_purifier_3h_fan_level
    data:
      value: 2
    action: number.set_value
- id: air_quality_air_purifier_switch_fan_level_to_1
  alias: Zmiana prędkości oczyszczacza na 1
  description: ''
  triggers:
  - entity_id: sensor.xiaomi_mi_air_purifier_3h_pm2_5
    below: 100
    for:
      minutes: 2
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: fan.oczyszczacz_powietrza_salon
    state: 'on'
  - condition: numeric_state
    entity_id: number.xiaomi_mi_air_purifier_3h_fan_level
    above: 1
  actions:
  - entity_id: number.xiaomi_mi_air_purifier_3h_fan_level
    data:
      value: 1
    action: number.set_value
- id: heating_airing_begin
  alias: Początek przewietrzania
  description: ''
  triggers:
  - entity_id: input_boolean.heating_airing
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  actions:
  - data: {}
    action: script.heating_airing_begin
- id: heating_airing_end
  alias: Koniec przewietrzania
  description: ''
  triggers:
  - entity_id: input_boolean.heating_airing
    from: 'on'
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.heating
        state: 'on'
      sequence:
        data: {}
        action: script.heating_day
    default:
      data: {}
      action: script.heating_night
  - condition: state
    entity_id: binary_sensor.windows
    state: 'on'
  - data:
      title: Koniec przewietrzania
      message: Wyłączono tryb przewietrzania. Proszę zamknąć okna!
      tag: airing-end
      group: climate
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
      - service: notify.mobile_app_iphone_12
        type: ios
    action: python_script.notify
- id: heating_season_begin
  alias: Początek sezonu grzewczego
  description: ''
  triggers:
  - entity_id: input_boolean.heating_season
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.heating
        state: 'on'
      sequence:
      - data: {}
        action: script.heating_day
    default:
    - data: {}
      action: script.heating_night
- id: heating_season_end
  alias: Koniec sezonu grzewczego
  description: ''
  triggers:
  - entity_id: input_boolean.heating_season
    from: 'on'
    to: 'off'
    trigger: state
  actions:
  - data: {}
    action: script.heating_season_end
- id: light_turn_on_tree
  alias: Włącz oświetlenie drzewka o zachodzi słońca u Antka
  description: ''
  triggers:
  - platform: sun
    event: sunset
  - platform: state
    entity_id: binary_sensor.people_at_home
    to: 'on'
  conditions:
  - condition: state
    entity_id: binary_sensor.people_at_home
    state: 'on'
  - condition: sun
    after: sunset
  - condition: time
    before: '23:00:00'
  actions:
  - target:
      entity_id: light.drzewko_antek
    data: {}
    action: light.turn_on
- id: light_turn_off_when_away_mode
  alias: Wyłącz oświetlenie w trybie "poza domem"
  description: ''
  triggers:
  - entity_id: input_boolean.away_mode
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - data: {}
    action: script.devices_away_mode
- id: devices_turn_off_in_salon_when_no_motion
  alias: Wyłącz urządzenia w salonie gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_salon
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: state
    entity_id: media_player.philips_65oled707
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: light.ceiling_salon
      state: 'on'
    - condition: state
      entity_id: light.ledy_w_salonie
      state: 'on'
    - condition: state
      entity_id: light.lamp_salon
      state: 'on'
    - condition: state
      entity_id: fan.ceiling_salon
      state: 'on'
  - condition: time
    before: 07:00:00
  actions:
  - target:
      entity_id:
      - light.ceiling_salon
      - light.lamp_salon
      - fan.ceiling_salon
      - light.ledy_w_salonie
    data: {}
    action: homeassistant.turn_off
- id: light_scene_salon_auto_when_bulbs_turn_on
  alias: Aktywuj w salonie scenę oświetlenie automatyczne
  description: ''
  triggers:
  - entity_id:
    - light.ceiling_salon
    to: 'on'
    from: 'off'
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: state
      state: playing
      entity_id: media_player.playstation_5
  actions:
  - data:
      transition: 5
    target:
      entity_id:
      - scene.light_salon_auto
    action: scene.turn_on
- id: light_toggle_salon_bulbs
  alias: Włącz/wyłącz oświetlenie w salonie
  description: ''
  triggers:
  - device_id: 142c0c74f511cb5af11fa1d33e6437f7
    domain: shelly
    type: single_push
    subtype: button1
    trigger: device
  - event_type: ios.action_fired
    event_data:
      actionName: Toggle Salon Light
    trigger: event
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_1
    subtype: press
    trigger: device
    id: shelly_blu_remote
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_2
    subtype: press
    trigger: device
    id: shelly_blu_remote
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
      - condition: state
        entity_id: sensor.shelly_blu_remote_ef9f42_kanal
        state: '0'
    - condition: not
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
  actions:
  - target:
      entity_id: light.ceiling_salon
    data: {}
    action: light.toggle
- id: light_toggle_salon_light
  alias: Włącz/wyłącz LEDy w salonie
  description: ''
  triggers:
  - event_type: ios.action_fired
    event_data:
      actionName: Toggle Salon LEDs
    trigger: event
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_1
    subtype: press
    trigger: device
    id: shelly_blu_remote
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_2
    subtype: press
    trigger: device
    id: shelly_blu_remote
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
      - condition: state
        entity_id: sensor.shelly_blu_remote_ef9f42_kanal
        state: '1'
    - condition: not
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
  actions:
  - data: {}
    action: light.toggle
    target:
      entity_id: light.ledy_w_salonie
- id: light_turn_on_salon_lamp_when_dark_and_motion
  alias: Włącz lampę w salonie gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_salon
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.ledy_w_salonie
    from: 'on'
    to: 'off'
    trigger: state
  - entity_id: light.ceiling_salon
    from: 'on'
    to: 'off'
    trigger: state
  - entity_id:
    - media_player.philips_65oled707
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.motion_salon
    state: 'on'
  - condition: state
    entity_id: input_boolean.light_auto_turn_salon
    state: 'on'
  - condition: sun
    after: sunset
    before: sunrise
    before_offset: +00:10:00
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  - condition: state
    entity_id: light.ledy_w_salonie
    state: 'off'
  - condition: state
    entity_id: light.ceiling_salon
    state: 'off'
  - condition: state
    entity_id: media_player.philips_65oled707
    state: 'off'
  actions:
  - target:
      entity_id: light.lamp_salon
    data: {}
    action: light.turn_on
  - wait_for_trigger:
    - entity_id: binary_sensor.motion_salon
      from: 'on'
      to: 'off'
      trigger: state
    - entity_id:
      - light.ledy_salon
      from: 'off'
      to: 'on'
      trigger: state
    - entity_id: light.ceiling_salon
      from: 'off'
      to: 'on'
      trigger: state
  - target:
      entity_id: light.lamp_salon
    data: {}
    action: light.turn_off
- id: light_scene_film
  alias: Aktywuj w salonie scenę oświetlenie po zmierzchu po włączeniu filmu lub gry
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.playstation_5
    to: playing
  conditions:
  - condition: sun
    after: sunset
  - condition: template
    value_template: '{{ is_state(''light.ledy_salon'', ''on'') or is_state(''light.ceiling_salon'',
      ''on'') or is_state(''light.lamp_salon'', ''on'') }}'
  - condition: time
    after: '20:10:00'
  - condition: state
    entity_id: input_boolean.guests
    state: 'off'
  actions:
  - data:
      transition: 5
    target:
      entity_id:
      - scene.light_salon_dusk
    action: scene.turn_on
- id: light_scene_auto_after_film
  alias: Aktywuj w salonie scenę oświetlenie automatyczne po wyłączeniu filmu lub
    gry
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.playstation_5
    from: playing
    to:
    for:
      hours: 0
      minutes: 0
      seconds: 10
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: light.ledy_w_salonie
      state: 'on'
    - condition: state
      entity_id: light.ceiling_salon
      state: 'on'
    - condition: state
      entity_id: light.lamp_salon
      state: 'on'
  actions:
  - data:
      transition: 5
    target:
      entity_id:
      - scene.light_salon_auto
    action: scene.turn_on
- id: light_turn_off_toaleta_light_when_no_motion
  alias: Wyłącz oświetlenie w toalecie gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_toaleta
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: state
    entity_id: light.oswietlenie_toaleta
    state: 'on'
  actions:
  - target:
      entity_id: light.oswietlenie_toaleta
    data: {}
    action: light.turn_off
- id: light_turn_off_lazienka_light_when_no_motion
  alias: Wyłącz oświetlenie w łazience gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_lazienka
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: light.oswietlenie_lazienki
      state: 'on'
    - condition: state
      entity_id: light.lustro_lazienka
      state: 'on'
  actions:
  - target:
      entity_id:
      - light.lustro_lazienka
      - light.oswietlenie_lazienki
    data: {}
    action: light.turn_off
- id: light_turn_off_kuchnia_light_when_no_motion
  alias: Wyłącz oświetlenie w kuchni gdy nie ma ruchu
  description: ''
  triggers:
  - platform: state
    entity_id: binary_sensor.motion_kuchnia
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
  conditions:
  - condition: state
    entity_id: light.oswietlenie_kuchnia
    state: 'on'
  actions:
  - target:
      entity_id: light.oswietlenie_kuchnia
    data: {}
    action: light.turn_off
- id: light_turn_on_antresola_lampt_when_dark_and_motion
  alias: Włącz lampkę na antresoli gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_antresola
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - input_boolean.away_mode
    - light.gateway_antresola
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_antresola
    below: 8
  - condition: sun
    after: sunset
    before: sunrise
    before_offset: +00:10:00
  actions:
  - target:
      entity_id: light.gateway_antresola
    data:
      brightness: 200
      rgb_color:
      - '{{ (range(0, 255)|random) }}'
      - '{{ (range(0, 255)|random) }}'
      - '{{ (range(0, 255)|random) }}'
    action: light.turn_on
  - wait_for_trigger:
      entity_id: binary_sensor.motion_antresola
      from: 'on'
      to: 'off'
      trigger: state
  - target:
      entity_id: light.gateway_antresola
    data: {}
    action: light.turn_off
- id: light_turn_on_sypialnia_leds_when_dark_and_motion
  alias: Włącz LEDy w sypialni gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_sypialnia
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - input_boolean.away_mode
    - light.lightstrip_sypialnia
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_sypialnia
    below: 3
  - condition: sun
    before: sunrise
    after: sunset
    before_offset: +00:10:00
  actions:
  - data:
      brightness_pct: 35
      rgb_color:
      - 255
      - 226
      - 203
    target:
      entity_id: light.lightstrip_sypialnia
    action: light.turn_on
  - wait_for_trigger:
      entity_id: binary_sensor.motion_sypialnia
      from: 'on'
      to: 'off'
      trigger: state
  - target:
      entity_id: light.lightstrip_sypialnia
    data:
      transition: 10
    action: light.turn_off
- id: light_turn_on_korytarz_light_when_dark_and_motion
  alias: Włącz oświetlenie w korytarzu gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.ruch_korytarz
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: light.ceiling_korytarz
    state: 'off'
  - condition: sun
    before: sunrise
    after: sunset
    after_offset: 00:10:00
  actions:
  - target:
      entity_id: light.ceiling_korytarz
    data: {}
    action: light.turn_on
  - wait_for_trigger:
      entity_id: binary_sensor.ruch_korytarz
      from: 'on'
      to: 'off'
      trigger: state
  - target:
      entity_id: light.ceiling_korytarz
    data: {}
    action: light.turn_off
- id: light_turn_off_korytarz_lights_when_no_motion
  alias: Wyłącz oświetlenie w korytarzu gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.ruch_korytarz
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: state
    entity_id: light.ceiling_korytarz
    state: 'on'
  actions:
  - target:
      entity_id: light.ceiling_korytarz
    data: {}
    action: light.turn_off
- id: light_toggle_ceiling_antek
  alias: Włącz/wyłącz oświetlenie sufitowe u Antka
  description: ''
  triggers:
  - device_id: aabc0c68397757ef0cf5caa56a59d0c8
    domain: zha
    platform: device
    type: remote_button_long_press
    subtype: button
  actions:
  - action: light.toggle
    target:
      entity_id: light.oswietlenie_antek
    data: {}
- id: light_turn_off_antek_lights_when_no_motion
  alias: Wyłącz oświetlenie u Antka gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_antek
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.komputer_antka_status
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: light.lampa_biurkowa_antek
      state: 'on'
    - condition: state
      entity_id: light.oswietlenie_antek
      state: 'on'
    - condition: state
      entity_id: light.lightstrip_antek
      state: 'on'
  actions:
  - target:
      entity_id:
      - light.lampa_biurkowa_antek
      - light.lightstrip_antek
      - light.oswietlenie_antek
    data: {}
    action: light.turn_off
- id: light_turn_on_antek_leds_and_cabinet_when_dark_and_motion
  alias: Włącz LEDy u Antka gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_antek
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - input_boolean.away_mode
    - light.lightstrip_antek
    - light.oswietlenie_antek
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_antek
    below: 3
  - condition: sun
    after: sunset
    before: sunrise
    before_offset: +00:10:00
  actions:
  - data: {}
    action: script.light_turn_on_antek_leds
  - wait_for_trigger:
      entity_id: binary_sensor.motion_antek
      from: 'on'
      to: 'off'
      trigger: state
  - condition: state
    entity_id: binary_sensor.komputer_antka_status
    state: 'off'
  - data:
      transition: 10
    target:
      entity_id: light.lightstrip_antek
    action: light.toggle
- id: light_toggle_antek_leds
  alias: Włącz/wyłącz LEDy u Antka
  description: ''
  triggers:
  - device_id: aabc0c68397757ef0cf5caa56a59d0c8
    domain: zha
    platform: device
    type: remote_button_triple_press
    subtype: remote_button_triple_press
  - platform: device
    device_id: 7fd5d34776bed25cd216ca70f1a8a45d
    domain: shelly
    type: triple_push
    subtype: button1
  actions:
  - type: toggle
    device_id: 40c8e12009a311ebbd1ce5aa5e97a8d7
    entity_id: light.lightstrip_antek
    domain: light
- id: light_toggle_gabinet_ceiling_light_
  alias: Włącz/wyłącz oświetlenie sufitowe w gabinecie
  description: ''
  triggers:
  - platform: device
    device_id: 5794eabef0db436756c344ac7632d9bd
    domain: shelly
    type: single_push
    subtype: button1
  - platform: device
    device_id: 32d4a414f2347f65f26c23af29853f9d
    domain: bthome
    type: button_1
    subtype: press
  actions:
  - target:
      entity_id: light.ceiling_gabinet
    data: {}
    action: light.toggle
- id: light_toggle_gabinet_lamp
  alias: Włącz/wyłącz lampę w gabinecie
  description: ''
  triggers:
  - platform: device
    device_id: 5794eabef0db436756c344ac7632d9bd
    domain: shelly
    type: double_push
    subtype: button1
  - platform: device
    device_id: 32d4a414f2347f65f26c23af29853f9d
    domain: bthome
    type: button_2
    subtype: press
  actions:
  - target:
      entity_id: light.lamp_gabinet
    data: {}
    action: light.toggle
- id: light_turn_on_gabinet_lamp_when_dark_and_motion
  alias: Włącz lampę w gabinecie gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_gabinet
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - input_boolean.away_mode
    - light.ceiling_gabinet
    - light.lampa_biurkowa_gabinet
    - light.lamp_gabinet
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_gabinet
    below: 8
  - condition: state
    entity_id: input_boolean.light_auto_turn_gabinet
    state: 'on'
  - condition: sun
    before: sunrise
    before_offset: +00:10:00
    after: sunset
  actions:
  - target:
      entity_id: light.lamp_gabinet
    data:
      brightness_pct: 20
      transition: 3
    action: light.turn_on
  - wait_for_trigger:
      entity_id: binary_sensor.motion_gabinet
      from: 'on'
      to: 'off'
      trigger: state
  - target:
      entity_id: light.lamp_gabinet
    data:
      transition: 10
    action: light.turn_off
- id: light_turn_off_gabinet_light_when_no_motion
  alias: Wyłącz oświetlenie w gabinecie gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_gabinet
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.dell_latitude_5400_status
    state: 'off'
  - condition: state
    entity_id: binary_sensor.lenovo_thinkpad_t14_status
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: light.ceiling_gabinet
      state: 'on'
    - condition: state
      entity_id: light.lamp_gabinet
      state: 'on'
    - condition: state
      entity_id: light.lampa_biurkowa_gabinet
      state: 'on'
  actions:
  - target:
      entity_id:
      - light.ceiling_gabinet
      - light.lamp_gabinet
      - light.lampa_biurkowa_gabinet
    data: {}
    action: light.turn_off
- id: light_toggle_schody_leds
  alias: Włącz/wyłącz oświetlenie schodów
  description: ''
  triggers:
  - platform: state
    entity_id: event.shelly_1l_aacec4_przycisk_2
  conditions:
  - condition: state
    entity_id: event.shelly_1l_aacec4_przycisk_2
    attribute: event_type
    state: single_push
  actions:
  - target:
      entity_id: light.leds_schody
    data: {}
    action: light.toggle
- id: light_turn_on_schody_leds_when_motion_at_night
  alias: Włącz LEDy na schodach gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_schody
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - input_boolean.away_mode
    - light.leds_schody
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_antresola
    below: 9
  - condition: sun
    before: sunrise
    before_offset: +00:10:00
    after: sunset
  actions:
  - target:
      entity_id: light.leds_schody
    data: {}
    action: light.turn_on
  - wait_for_trigger:
      entity_id: binary_sensor.motion_schody
      from: 'on'
      to: 'off'
      trigger: state
  - target:
      entity_id: light.leds_schody
    data: {}
    action: light.turn_off
- id: light_turn_on_schody_leds_on_sunset
  alias: Włącz LEDy na schodach o zachodzie słońca
  description: ''
  triggers:
  - event: sunset
    trigger: sun
  conditions:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  actions:
  - target:
      entity_id:
      - light.leds_schody
      - light.bonsai_w_salonie
    data: {}
    action: light.turn_on
- id: light_turn_off_schody_leds_on_midnight
  alias: Wyącz LEDy na schodach o północy
  description: ''
  triggers:
  - at: 00:00:00
    trigger: time
  actions:
  - target:
      entity_id:
      - light.leds_schody
      - light.bonsai_w_salonie
    data: {}
    action: light.turn_off
- id: light_turn_on_goscinny_lamp_when_dark_and_motion
  alias: Włącz lampkę w gościnnym gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_goscinny
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - input_boolean.away_mode
    - light.lampka_goscinny
    state: 'off'
  - condition: state
    entity_id: light.ceiling_goscinny
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_goscinny
    below: 8
  - condition: state
    entity_id: input_boolean.light_auto_turn_goscinny
    state: 'on'
  - condition: sun
    after: sunset
    before: sunrise
    before_offset: +00:10:00
  actions:
  - target:
      entity_id: light.lampka_goscinny
    data: {}
    action: light.turn_on
  - wait_for_trigger:
      entity_id: binary_sensor.motion_goscinny
      from: 'on'
      to: 'off'
      trigger: state
  - target:
      entity_id: light.lampka_goscinny
    data: {}
    action: light.turn_off
- id: humidification_set_target_humidity
  alias: Ustaw docelową wilgotność
  description: ''
  triggers:
  - entity_id:
    - input_number.target_humidity
    trigger: state
  actions:
  - entity_id:
    - humidifier.xiaomi_mi_humidifier_cb1
    data:
      humidity: '{{ states(''input_number.target_humidity'') }}'
    action: humidifier.set_humidity
- id: log_level
  alias: Ustawianie poziomu logowania
  description: ''
  triggers:
  - platform: state
    entity_id: input_select.log_level
  actions:
  - action: logger.set_level
    data:
      homeassistant.components: '{{ trigger.to_state.state }}'
- id: shellies_announce
  alias: Wysyłanie komendy announce do urządzeń Shelly
  description: ''
  triggers:
  - event: start
    trigger: homeassistant
  - hours: /1
    trigger: time_pattern
  actions:
  - data:
      topic: shellies/command
      payload: announce
    action: mqtt.publish
- id: shellies_discovery
  alias: Uruchamianie Shellies Discovery
  description: ''
  triggers:
  - platform: mqtt
    topic: shellies/announce
  conditions:
  - condition: template
    value_template: '{{ trigger.payload_json.gen is not defined }}'
  actions:
  - data:
      id: '{{ trigger.payload_json.id }}'
      mac: '{{ trigger.payload_json.mac }}'
      fw_ver: '{{ trigger.payload_json.fw_ver }}'
      model: '{{ trigger.payload_json.model }}'
      mode: '{{ trigger.payload_json.mode | default }}'
      host: '{{ trigger.payload_json.ip }}'
      qos: 1
      shellyswitch25-C45BBE77DBE5:
        device_name: Shelly 2.5 [77DBE5]
        relay-1: light
      ShellyBulbDuo-8CAAB55F6FA1:
        device_name: Shelly DUO [5F6FA1]
      shellyflood-F2AD1D:
        device_name: Shelly Flood [F2AD1D]
        expire_after: 95040
      shellygas-E868E7C6811C:
        device_name: Shelly Gas [C6811C]
      shellymotion2-84FD2772A6A4:
        device_name: Shelly Motion 2 [72A6A4]
      shellytrv-84FD2772A544:
        device_name: Shelly Valve [72A544]
        default_heating_temperature: '{{ states(''input_number.temperature_day'')
          | int(20) }}'
        humidity_topic: shellies/shellytrv-84FD2772A544/humidity
    action: python_script.shellies_discovery
  mode: queued
  max: 999
- id: hassio_backup
  alias: Wykonanie kopii zapasowej
  description: ''
  triggers:
  - at: 02:00:00
    trigger: time
  conditions:
  - condition: time
    weekday:
    - sun
  actions:
  - data:
      name: '{{ now().strftime(''%Y-%m-%d'') }}'
      location: Synology
    action: hassio.backup_full
- id: '1658514116580'
  alias: Włącz/wyłącz wentylator w salonie
  description: ''
  triggers:
  - device_id: 142c0c74f511cb5af11fa1d33e6437f7
    domain: shelly
    type: double_push
    subtype: button1
    trigger: device
  - event_type: ios.action_fired
    event_data:
      actionName: Toggle Salon Fan
    trigger: event
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_1
    subtype: press
    trigger: device
    id: shelly_blu_remote
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_2
    subtype: press
    trigger: device
    id: shelly_blu_remote
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
      - condition: state
        entity_id: sensor.shelly_blu_remote_ef9f42_kanal
        state: '2'
    - condition: not
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
  actions:
  - data: {}
    target:
      entity_id: fan.ceiling_salon
    action: fan.toggle
  mode: single
- id: '1658514193572'
  alias: Włącz/wyłącz lampę w salonie
  description: ''
  triggers:
  - device_id: 142c0c74f511cb5af11fa1d33e6437f7
    domain: shelly
    type: double_push
    subtype: button2
    trigger: device
  - event_type: ios.action_fired
    event_data:
      actionName: Toggle Salon Lamp
    trigger: event
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: light.lamp_salon
    action: light.toggle
  mode: single
- id: '1658522979417'
  alias: Włącz/wyłącz oświetlenie drzewka u Antka
  description: ''
  triggers:
  - device_id: aabc0c68397757ef0cf5caa56a59d0c8
    domain: zha
    platform: device
    type: remote_button_double_press
    subtype: remote_button_double_press
  - platform: device
    device_id: 7fd5d34776bed25cd216ca70f1a8a45d
    domain: shelly
    type: double_push
    subtype: button1
  condition: []
  actions:
  - data: {}
    target:
      entity_id: light.drzewko_antek
    action: light.toggle
  mode: single
- id: light_turn_off_goscinny_light_when_no_motion
  alias: Wyłącz oświetlenie w pokoju gościnnym gdy nie ma ruchu
  description: ''
  triggers:
  - platform: state
    entity_id: binary_sensor.motion_goscinny
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
  conditions:
  - condition: state
    entity_id: light.ceiling_goscinny
    state: 'on'
  actions:
  - action: light.turn_off
    target:
      entity_id: light.ceiling_goscinny
    data: {}
- id: '1670319144056'
  alias: Odtwarzaj/wstrzymaj media w gabinecie
  description: ''
  triggers:
  - device_id: 5794eabef0db436756c344ac7632d9bd
    domain: shelly
    type: triple_push
    subtype: button1
    trigger: device
  - device_id: 32d4a414f2347f65f26c23af29853f9d
    domain: bthome
    type: button_4
    subtype: press
    trigger: device
  actions:
  - data: {}
    target:
      entity_id:
      - media_player.sonos_one
    action: media_player.media_play_pause
- id: '1671558014151'
  alias: Rozpoczęcie nawilżania w sypialni
  description: ''
  triggers:
  - entity_id: sensor.humidity_sypialnia
    for:
      hours: 0
      minutes: 2
      seconds: 0
    below: input_number.target_humidity
    trigger: numeric_state
  conditions:
  - condition: numeric_state
    entity_id: sensor.xiaomi_mi_humidifier_cb1_poziom_wody
    above: 5
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: state
    entity_id: input_boolean.heating_airing
    state: 'off'
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  - condition: state
    entity_id: humidifier.xiaomi_mi_humidifier_cb1
    state: 'off'
  actions:
  - entity_id: humidifier.xiaomi_mi_humidifier_cb1
    action: humidifier.turn_on
- id: '1671558157880'
  alias: Zakończenie nawilżania w sypialni
  description: ''
  triggers:
  - entity_id: sensor.humidity_sypialnia
    for:
      hours: 0
      minutes: 2
      seconds: 0
    above: input_number.target_humidity
    trigger: numeric_state
  - entity_id: sensor.xiaomi_mi_humidifier_cb1_poziom_wody
    below: 6
    for:
      minutes: 5
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: state
    entity_id: humidifier.xiaomi_mi_humidifier_cb1
    state: 'on'
  actions:
  - entity_id: humidifier.xiaomi_mi_humidifier_cb1
    action: humidifier.turn_off
  - condition: numeric_state
    entity_id: sensor.xiaomi_mi_humidifier_cb1_poziom_wody
    below: 6
  - choose:
      conditions:
        condition: state
        entity_id: person.maciek
        state: home
      sequence:
        data:
          title: '{{ notification_title }}'
          message: '{{ notification_message }}'
          tag: '{{ notification_tag }}'
          services:
          - service: notify.mobile_app_iphone_13
            type: ios
        action: python_script.notify
  - choose:
      conditions:
        condition: state
        entity_id: person.edyta
        state: home
      sequence:
        data:
          title: '{{ notification_title }}'
          message: '{{ notification_message }}'
          tag: '{{ notification_tag }}'
          services:
          - service: notify.mobile_app_iphone_12
            type: ios
        action: python_script.notify
  variables:
    notification_title: Uzupełnij wodę w nawilżaczu
    notification_message: Nawilżacz w sypialni został wyłączony ponieważ w zbiorniku
      pozostało {{ states('sensor.xiaomi_mi_humidifier_cb1_poziom_wody') }}% wody.
    notification_tag: humidifier
- id: '1671558318632'
  alias: Mało wody w nawilżaczu w sypialni
  triggers:
  - entity_id:
    - sensor.xiaomi_mi_humidifier_cb1_poziom_wody
    below: 20
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: numeric_state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: person.maciek
      state: home
    - condition: state
      entity_id: person.edyta
      state: home
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: template
    value_template: '{{ states(''sensor.xiaomi_mi_humidifier_cb1_poziom_wody'') |
      int(999) != 0 }}'
  actions:
  - parallel:
    - choose:
        conditions:
          condition: state
          entity_id: person.maciek
          state: home
        sequence:
          data:
            title: '{{ notification_title }}'
            message: '{{ notification_message }}'
            tag: '{{ notification_tag }}'
            services:
            - service: notify.mobile_app_iphone_13
              type: ios
          action: python_script.notify
    - choose:
        conditions:
          condition: state
          entity_id: person.edyta
          state: home
        sequence:
          data:
            title: '{{ notification_title }}'
            message: '{{ notification_message }}'
            tag: '{{ notification_tag }}'
            services:
            - service: notify.mobile_app_iphone_12
              type: ios
          action: python_script.notify
  variables:
    notification_title: Uzupełnij wodę w nawilżaczu
    notification_message: W zbiorniku nawilżacza w sypialni pozostało {{ states('sensor.xiaomi_mi_humidifier_cb1_poziom_wody')
      }}% wody.
    notification_tag: humidifier
- id: '1672476393165'
  alias: Włącz/wyłącz oświetlenie w pokoju gościnnym
  description: ''
  triggers:
  - platform: device
    device_id: 84783955a9dda947e7b647309a6b15f9
    domain: shelly
    type: single_push
    subtype: button1
  - device_id: 1f8b076d4a78b00888e90626c7c9a919
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: remote_button_short_press
  condition: []
  actions:
  - data: {}
    target:
      entity_id: light.ceiling_goscinny
    action: light.toggle
  mode: single
- id: '1672477395224'
  alias: Włącz/wyłącz lampkę w pokoju gościnnym
  description: ''
  triggers:
  - device_id: 84783955a9dda947e7b647309a6b15f9
    domain: shelly
    type: double_push
    subtype: button1
    trigger: device
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: light.lampka_goscinny
    action: light.toggle
  mode: single
- id: '1672489364549'
  alias: Włącz/wyłącz lapkę biurkową u Antka
  description: ''
  triggers:
  - device_id: aabc0c68397757ef0cf5caa56a59d0c8
    domain: zha
    type: remote_button_short_press
    subtype: remote_button_short_press
    trigger: device
  - device_id: 7fd5d34776bed25cd216ca70f1a8a45d
    domain: shelly
    type: long_push
    subtype: button1
    trigger: device
  conditions: []
  actions:
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      entity_id: light.lampa_biurkowa_antek
  mode: single
- id: '1672565177379'
  alias: Wyłącz oświetlenie o 1:00 u Antka
  description: ''
  triggers:
  - at: 00:10:00
    trigger: time
  conditions: []
  actions:
  - data: {}
    target:
      entity_id:
      - light.drzewko_antek
      - light.lampa_biurkowa_antek
      - light.lightstrip_antek
    action: light.turn_off
  mode: single
- id: '1672565410928'
  alias: Włącz oświetlenie drzewka o zachodzie słońca
  description: ''
  triggers:
  - platform: sun
    event: sunset
    offset: 0
  condition: []
  actions:
  - data: {}
    target:
      entity_id: light.drzewko_antek
    action: light.turn_on
  mode: single
- id: '1673781976268'
  alias: Koniec prania
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.pralka_pralnia
    from: 'on'
    to: 'off'
    for:
      minutes: 1
    trigger: state
  actions:
  - parallel:
    - if:
      - condition: state
        entity_id: person.maciek
        state: home
      then:
      - data:
          title: Koniec prania
          message: Pralka zakończyła pranie.
          tag: washing-machine
          group: home
          services:
          - service: notify.mobile_app_iphone_13
            type: ios
        action: python_script.notify
    - if:
      - condition: state
        entity_id: person.edyta
        state: home
      then:
      - data:
          title: Koniec prania
          message: Pralka zakończyła pranie.
          tag: washing-machine
          group: home
          services:
          - service: notify.mobile_app_iphone_12
            type: ios
        action: python_script.notify
- id: '1678536051718'
  alias: Dym w mieszkaniu
  description: ''
  triggers:
  - entity_id: binary_sensor.smoke_antresola
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id: binary_sensor.smoke_kuchnia
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - data:
      title: Dym
      message: "{% if \"antresola\" in trigger.entity_id %}\n  Uwaga! Wykryto dym
        na antresoli!\n{% else %}\n  Uwaga! Wykryto dym w kuchni!\n{% endif %}"
      tag: smoke-{{ area_name(trigger.entity_id) }}
      priority: high
      group: smoke
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
      - service: notify.mobile_app_iphone_12
        type: ios
      - service: notify.mobile_app_iphone_15_pro
        type: ios
    action: python_script.notify
- id: '1678536227339'
  alias: Uruchomienie automatycznego testu czujnika gazu
  description: ''
  triggers:
  - at: 03:00:00
    trigger: time
  conditions:
  - condition: time
    weekday:
    - sun
  actions:
  - action: python_script.notify
    data:
      title: Test czujnika gazu
      message: Rozpoczynam test czujnika gazu...
      tag: gas-detector
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  - device_id: 07ee2d658bd1fbdce765f6707e48f76d
    domain: button
    entity_id: button.shelly_gas_c6811c_self_test
    type: press
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - sensor.shelly_gas_c6811c_wynik_autotestu
      from: running
  - action: python_script.notify
    data:
      title: Test czujnika gazu
      message: 'Wynik testu: {{ states(''sensor.shelly_gas_c6811c_wynik_autotestu'')
        }}'
      tag: gas-detector
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  mode: single
- id: '1682413050614'
  alias: Włącz/wyłącz lampkę w sypialni
  description: ''
  triggers:
  - platform: device
    device_id: 9c1d6b506fc5c2b66d70325621df177f
    domain: bthome
    type: button
    subtype: press
  - platform: device
    device_id: d126835937feceeaf66137ca3321675d
    domain: shelly
    type: double_push
    subtype: button1
  - platform: device
    device_id: d126835937feceeaf66137ca3321675d
    domain: shelly
    type: double_push
    subtype: button2
  condition: []
  actions:
  - type: toggle
    device_id: 0614f4b07155c115d1e506fffeed1acf
    entity_id: light.table_lamp_sypialnia
    domain: light
  mode: single
- id: '1686430803024'
  alias: Wyłącz oświetlenie w sypialni gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_sypialnia
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: light.oswietlenie_lozka_w_sypialni
      state: 'on'
    - condition: state
      entity_id: light.oswietlenie_sypialni
      state: 'on'
    - condition: state
      entity_id: light.oswietlenie_garderoby
      state: 'on'
  actions:
  - target:
      entity_id:
      - light.oswietlenie_garderoby
      - light.oswietlenie_sypialni
      - light.oswietlenie_lozka_w_sypialni
    data: {}
    action: light.turn_off
- id: '1687849080259'
  alias: Pomocnik oświetlenia w salonie
  description: ''
  triggers:
  - entity_id:
    - light.ceiling_salon
    to: unavailable
    for:
      hours: 0
      minutes: 2
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data: {}
    action: switch.turn_off
    target:
      entity_id:
      - switch.wentylator_i_oswietlenie_w_salonie
  - delay:
      hours: 0
      minutes: 0
      seconds: 7
      milliseconds: 0
  - data: {}
    action: switch.turn_on
    target:
      entity_id: switch.wentylator_i_oswietlenie_w_salonie
  mode: single
- id: '1693856668458'
  alias: Aktywuj w salonie scenę oświetlenie po zmierzchu
  description: ''
  triggers:
  - entity_id:
    - light.ceiling_salon
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      state: playing
      entity_id: media_player.playstation_5
  actions:
  - target:
      entity_id: scene.light_salon_dusk
    metadata: {}
    action: scene.turn_on
    data: {}
  mode: single
- id: '1699100330008'
  alias: Edyta wraca do domu
  description: ''
  triggers:
  - entity_id:
    - sensor.dom_edyta_direction_of_travel
    to: towards
    trigger: state
  conditions:
  - condition: state
    entity_id: person.maciek
    state: home
  - condition: numeric_state
    entity_id: sensor.dom_edyta_distance
    above: 2
    below: 200
  actions:
  - data:
      title: Edyta wraca do domu
      message: Edyta wraca do domu i jest w odległości {{ states('sensor.dom_edyta_distance')
        | round }} km.
      tag: '{{ trigger.entity_id }}'
      group: family
      latitude: '{{ state_attr("person.edyta", "latitude") }}'
      longitude: '{{ state_attr("person.edyta", "longitude") }}'
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
  mode: single
- id: '1705870734815'
  alias: Wyłącz oświetlenie w pracowni gdy nie ma ruchu
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_pracownia
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.status_hp_elitebook_840_g10
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: light.ceiling_pracownia
      state: 'on'
  actions:
  - target:
      entity_id:
      - light.ceiling_pracownia
    data: {}
    action: light.turn_off
- id: '1709306186649'
  alias: Włącz LEDy na przedpokoju gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id: binary_sensor.motion_przedpokoj
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - light.oswietlenie_przedpokoj
    - light.leds_przedpokoj
    - light.ceiling_salon
    - light.ledy_w_salonie
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_przedpokoj
    below: 9
  - condition: sun
    before: sunrise
    before_offset: +00:10:00
    after: sunset
  actions:
  - target:
      entity_id: light.leds_przedpokoj
    data: {}
    action: light.turn_on
  - wait_for_trigger:
      entity_id: binary_sensor.motion_przedpokoj
      from: 'on'
      to: 'off'
      trigger: state
  - target:
      entity_id: light.leds_przedpokoj
    data: {}
    action: light.turn_off
  mode: single
- id: '1709306300471'
  alias: Wyłącz oświetlenie w przedpokoju gdy nie ma ruchu
  description: ''
  triggers:
  - platform: state
    entity_id: binary_sensor.motion_przedpokoj
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: light.leds_przedpokoj
      state: 'on'
    - condition: state
      entity_id: light.oswietlenie_przedpokoj
      state: 'on'
    - condition: state
      entity_id: light.ceiling_korytarz
      state: 'on'
  actions:
  - target:
      entity_id:
      - light.leds_przedpokoj
      - light.oswietlenie_przedpokoj
      - light.ceiling_korytarz
    data: {}
    action: light.turn_off
  mode: single
- id: '1710416852993'
  alias: Nocne oszczędzanie energii telewizora w pokoju gościnnym
  description: ''
  triggers:
  - entity_id:
    - schedule.energy_consumption_reduction
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.to_state.state == "on" }}'
    - condition: state
      entity_id: input_boolean.guests
      state: 'off'
    then:
    - target:
        entity_id: switch.zasilanie_telewizora_goscinny
      data: {}
      action: switch.turn_off
  - if:
    - condition: template
      value_template: '{{ trigger.to_state.state == "off" }}'
    - condition: state
      entity_id: input_boolean.guests
      state: 'on'
    then:
    - target:
        entity_id:
        - switch.zasilanie_telewizora_goscinny
      data: {}
      action: switch.turn_on
  mode: single
- id: '1715247759498'
  alias: Niedostępne urządzenia lub usługi
  description: ''
  triggers:
  - minutes: /15
    trigger: time_pattern
  conditions: []
  actions:
  - data:
      entries: "{% set checked_domains = [\"binary_sensor\", \"climate\", \"fan\",
        \"humidifier\", \"light\", \"media_player\", \"sensor\", \"switch\"] %}\n{%
        set ignored_entities = [\"switch.philips_65oled707_screen_state\", \"light.philips_65oled707_ambilight\",
        \"sensor.bzura_temperatura_wody\"] %}\n{% set ignored_entries = [\"Sony KD-55XF8596\",
        \"Bzura\", \"BMW 220\"] %}\n{% macro unavailable_entries() %}\n  {% for domain
        in checked_domains %}\n    {% for entity_id in states[domain] | selectattr(\"state\",
        \"==\", \"unavailable\") | map(attribute=\"entity_id\") if entity_id not in
        ignored_entities %}\n      {% set entry_name = device_name(entity_id) %}\n
        \     {% if entry_name not in ignored_entries and entry_name != None %}\n
        \       {{ entry_name }}@{{ area_name(entity_id) }}|\n      {% endif %}\n
        \   {% endfor %}\n  {% endfor %}\n{% endmacro %}\n{{ unavailable_entries()
        }}"
    action: python_script.unavailable_entries
  mode: queued
  max: 10
- id: '1715426726944'
  alias: Wyłącz oświetlenie w pralni gdy nie ma ruchu
  description: ''
  triggers:
  - platform: state
    entity_id:
    - binary_sensor.motion_pralnia
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
  conditions:
  - condition: state
    entity_id: light.oswietlenie_pralnia
    state: 'on'
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.oswietlenie_pralnia
    data: {}
  mode: single
- id: '1719055090033'
  alias: Włącz/wyłącz wentylator w gabinecie
  description: ''
  triggers:
  - platform: device
    device_id: 5794eabef0db436756c344ac7632d9bd
    domain: shelly
    type: long_push
    subtype: button1
  - platform: device
    device_id: 32d4a414f2347f65f26c23af29853f9d
    domain: bthome
    type: button_3
    subtype: press
  condition: []
  actions:
  - metadata: {}
    data: {}
    target:
      entity_id: fan.xiaomi_mi_standing_fan_1x
    action: fan.toggle
  mode: single
- id: '1719057451463'
  alias: Włącz/wyłącz LEDy w sypialni
  description: ''
  triggers:
  - platform: device
    device_id: d126835937feceeaf66137ca3321675d
    domain: shelly
    type: triple_push
    subtype: button1
  - platform: device
    device_id: d126835937feceeaf66137ca3321675d
    domain: shelly
    type: triple_push
    subtype: button2
  condition: []
  actions:
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      entity_id: light.lightstrip_sypialnia
  mode: single
- id: '1723288584908'
  alias: Włącz smart TV w salonie
  description: ''
  triggers:
  - event_type: ios.action_fired
    event_data:
      actionName: Turn On Smart TV
    trigger: event
  conditions: []
  actions:
  - action: script.alexa_harmony_activity_smart_tv
    metadata: {}
    data: {}
  mode: single
- id: '1723288816878'
  alias: Włącz gry w salonie
  description: ''
  triggers:
  - event_type: ios.action_fired
    event_data:
      actionName: Turn On Games
    trigger: event
  conditions: []
  actions:
  - action: script.alexa_harmony_activity_games
    metadata: {}
    data: {}
  mode: single
- id: '1723301586705'
  alias: Zwiększ głośność w salonie
  description: ''
  triggers:
  - event_type: ios.action_fired
    event_data:
      actionName: Turn Up TV Volume
    trigger: event
  - trigger: state
    entity_id:
    - event.shelly_blu_remote_ef9f42_sciemniacz
    id: shelly_blu_remote
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
      - condition: state
        entity_id: sensor.shelly_blu_remote_ef9f42_kanal
        state: '3'
      - condition: state
        entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
        attribute: event_type
        state: rotate_left
      - condition: numeric_state
        entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
        attribute: steps
        above: 0
    - condition: not
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
  actions:
  - action: media_player.volume_up
    metadata: {}
    data: {}
    target:
      entity_id: media_player.sonos_arc
  mode: queued
  max: 10
- id: '1723301743769'
  alias: Zmniejsz głośność w salonie
  description: ''
  triggers:
  - event_type: ios.action_fired
    event_data:
      actionName: Turn Down TV Volume
    trigger: event
  - trigger: state
    entity_id:
    - event.shelly_blu_remote_ef9f42_sciemniacz
    id: shelly_blu_remote
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
      - condition: state
        entity_id: sensor.shelly_blu_remote_ef9f42_kanal
        state: '3'
      - condition: state
        entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
        attribute: event_type
        state: rotate_right
      - condition: numeric_state
        entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
        attribute: steps
        above: 0
    - condition: not
      conditions:
      - condition: trigger
        id:
        - shelly_blu_remote
  actions:
  - action: media_player.volume_down
    metadata: {}
    data: {}
    target:
      entity_id: media_player.sonos_arc
  mode: queued
  max: 10
- id: '1725635170993'
  alias: Włącz oświetlenie blatu w kuchni gdy pojawi się ruch i jest po zachodzie
    słońca
  description: ''
  triggers:
  - platform: state
    entity_id: binary_sensor.motion_kuchnia
    from: 'off'
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  - condition: state
    entity_id: light.blat_kuchnia
    state: 'off'
  - condition: sun
    before: sunrise
    after: sunset
  actions:
  - target:
      entity_id: light.blat_kuchnia
    action: light.turn_on
    data: {}
  - wait_for_trigger:
      platform: state
      entity_id: binary_sensor.motion_kuchnia
      from: 'on'
      to: 'off'
  - target:
      entity_id: light.blat_kuchnia
    action: light.turn_off
    data: {}
- id: '1725785049250'
  alias: Włącz/wyłącz oświetlenie w pracowni
  description: ''
  triggers:
  - device_id: 12765067d8e37adeadb4188a5b9b0c5c
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: remote_button_short_press
  condition: []
  actions:
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      entity_id: light.ceiling_pracownia
  mode: single
- id: '1728586481244'
  alias: Raportowanie temperatury do termostatu w salonie
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.temperatura_salon
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: template
    value_template: '{{ now().timestamp() - as_timestamp(this.attributes.last_triggered,
      0) > 300 }}'
  - condition: template
    value_template: '{{ is_number(trigger.to_state.state) }}'
  actions:
  - action: number.set_value
    data:
      value: '{{ trigger.to_state.state | float }}'
    target:
      entity_id: number.temperatura_zewnetrznego_sensora_salon
  mode: single
- id: '1728588099095'
  alias: Raportowanie temperatury do termostatu w sypialni
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.temperature_sypialnia
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: template
    value_template: '{{ now().timestamp() - as_timestamp(this.attributes.last_triggered,
      0) > 300 }}'
  - condition: template
    value_template: '{{ is_number(trigger.to_state.state) }}'
  actions:
  - action: number.set_value
    data:
      value: '{{ trigger.to_state.state | float }}'
    target:
      entity_id: number.temperatura_zewnetrznego_sensora_sypialnia
  mode: single
- id: '1728663268346'
  alias: Raportowanie temperatury do termostatu u Antka
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.temperature_antek
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: template
    value_template: '{{ now().timestamp() - as_timestamp(this.attributes.last_triggered,
      0) > 300 }}'
  - condition: template
    value_template: '{{ is_number(trigger.to_state.state) }}'
  actions:
  - action: number.set_value
    data:
      value: '{{ trigger.to_state.state | float }}'
    target:
      entity_id: number.temperatura_zewnetrznego_sensora_antek
  mode: single
- id: '1728663344425'
  alias: Raportowanie temperatury do termostatu w pracowni
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.temperature_pracownia
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: template
    value_template: '{{ now().timestamp() - as_timestamp(this.attributes.last_triggered,
      0) > 300 }}'
  - condition: template
    value_template: '{{ is_number(trigger.to_state.state) }}'
  actions:
  - action: number.set_value
    data:
      value: '{{ trigger.to_state.state | float }}'
    target:
      entity_id: number.temperatura_zewnetrznego_sensora_pracownia
  mode: single
- id: '1728663436906'
  alias: Raportowanie temperatury do termostatu w kuchni
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.temperature_kuchnia
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: template
    value_template: '{{ now().timestamp() - as_timestamp(this.attributes.last_triggered,
      0) > 300 }}'
  - condition: template
    value_template: '{{ is_number(trigger.to_state.state) }}'
  actions:
  - action: number.set_value
    data:
      value: '{{ trigger.to_state.state | float }}'
    target:
      entity_id: number.temperatura_zewnetrznego_sensora_kuchnia
  mode: single
- id: '1729346953236'
  alias: Wyłącz oświetlenie blatu w kuchni jak nie ma ruchu
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.motion_kuchnia
    from: 'on'
    to: 'off'
    for:
      minutes: '{{ states(''input_number.no_motion_time'') | int }}'
  conditions:
  - condition: state
    entity_id: light.blat_kuchnia
    state: 'on'
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.blat_kuchnia
  mode: single
- id: '1733758713539'
  alias: Powiadomienie o braku kalibracji dla Shelly BLU TRV
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.shelly_blu_trv_7744f8_kalibracja
    from: 'off'
    to: 'on'
  conditions: []
  actions:
  - data:
      title: Brak kalibracji dla Shelly BLU TRV
      message: Shelly BLU TRV w łazience zgłasza brak kalibracji.
      tag: blu-trv-calibration
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
  mode: single
- id: '1735983352747'
  alias: Baterie psich trackerów
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.luna_bateria_trackera
    - sensor.karmel_bateria_trackera
    for:
      hours: 0
      minutes: 15
      seconds: 0
    below: 50
  conditions: []
  actions:
  - data:
      title: Poziom baterii trackera
      message: Poziom baterii trackera {{ device_name(trigger.entity_id) }} wynosi
        {{ trigger.to_state.state }}%. Rozważ ładowanie.
      tag: tracker-battery
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
  mode: single
- id: '1738692240675'
  alias: Zmniejsz temperaturę w pomieszczeniach biurowych po pracy
  description: ''
  triggers:
  - trigger: time
    at: '16:00:00'
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  actions:
  - action: climate.set_temperature
    metadata: {}
    data:
      temperature: 20
    target:
      entity_id:
      - climate.grzejnik_gabinet
      - climate.grzejnik_pracownia
  mode: single
- id: '1741967732368'
  alias: Sugestia wyłączenia ogrzewania
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.srednia_temperatura_zewnetrzna
    for:
      hours: 2
      minutes: 0
      seconds: 0
    above: 8
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'on'
  actions:
  - action: python_script.notify
    data:
      title: Propozycja włączenia ogrzewania
      message: Średnia temperatura zewnętrzna wynosi {{ trigger.to_state.state }}°C,
        prawdopodobnie należy wyłączyć ogrzewanie.
      tag: heating
      group: climate
      actions:
      - action: TURN_OFF_HEATING
        title: Wyłącz ogrzewanie
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  mode: single
- id: '1746095039819'
  alias: Nowe firmware dla Shelly BLU TRV
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.shelly_blu_trv_firmware
    not_from:
    - unavailable
    - unknown
    not_to:
    - unavailable
    - unknown
  conditions: []
  actions:
  - action: python_script.notify
    data:
      title: Aktualizacja firmware dla Shelly BLU TRV
      message: Dostępna jest wersja {{ trigger.to_state.state }} firmware dla Shelly
        BLU TRV.
      tag: blu-trv-firmware
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  mode: single
- id: '1747156465397'
  alias: Sugestia włączenia ogrzewania
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.srednia_temperatura_zewnetrzna
    for:
      hours: 2
      minutes: 0
      seconds: 0
    below: 7
  conditions:
  - condition: state
    entity_id: input_boolean.heating_season
    state: 'off'
  actions:
  - action: python_script.notify
    data:
      title: Propozycja włączenia ogrzewania
      message: Średnia temperatura zewnętrzna wynosi {{ trigger.to_state.state }}°C,
        prawdopodobnie należy włączyć ogrzewanie.
      tag: heating
      group: climate
      actions:
      - action: TURN_ON_HEATING
        title: Włącz ogrzewanie
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  mode: single
- id: '1749036207006'
  alias: Uruchomienie automatycznego testu baterii UPSa
  description: ''
  triggers:
  - trigger: time
    at: '12:00:00'
  conditions:
  - condition: time
    weekday:
    - sun
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  - condition: template
    value_template: '{{ now().day <= 7 }}'
  actions:
  - action: python_script.notify
    data:
      title: Test baterii UPSa
      message: Rozpoczynam test baterii UPSa...
      tag: ups
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  - type: test_battery_start_quick
    device_id: 56aac98c75cff43ba6a6b085f7be64f6
    domain: nut
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - sensor.cyberpower_dl650elcd_wynik_autotestu
  - action: python_script.notify
    data:
      title: Test baterii UPSa
      message: 'Wynik testu: {{ states("sensor.cyberpower_dl650elcd_wynik_autotestu").lower()
        }}'
      tag: ups
      group: devices
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  mode: single
- id: '1749060877485'
  alias: Zakończ sezon grzewczy
  description: ''
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: TURN_OFF_HEATING
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.heating_season
  mode: single
- id: '1749060970009'
  alias: Rozpocznij sezon grzewczy
  description: ''
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: TURN_ON_HEATING
  conditions: []
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.heating_season
  mode: single
- id: '1749295199110'
  alias: Włącz oświetlenie lustra w łazience gdy pojawi się ruch i jest ciemno
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.motion_lazienka
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  - condition: state
    entity_id: light.oswietlenie_lazienki
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.illumination_lazienka
    below: 8
  - condition: state
    entity_id: input_boolean.oswietlenie_lazienki_zalaczane_ruchem
    state: 'on'
  actions:
  - data:
      brightness_pct: 20
      transition: 3
    action: light.turn_on
    target:
      entity_id: light.lustro_lazienka
  - wait_for_trigger:
    - entity_id:
      - binary_sensor.motion_lazienka
      from: 'on'
      to: 'off'
      trigger: state
  - data:
      transition: 10
    action: light.turn_off
    target:
      entity_id: light.lustro_lazienka
  mode: single
- id: '1749810787760'
  alias: Zmniejsz jasność oświetlenia w salonie
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.shelly_blu_remote_ef9f42_sciemniacz
  conditions:
  - condition: state
    entity_id: sensor.shelly_blu_remote_ef9f42_kanal
    state: '0'
  - condition: state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: event_type
    state: rotate_right
  - condition: numeric_state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: steps
    above: 0
  actions:
  - action: light.turn_on
    metadata: {}
    data:
      brightness_step_pct: '{{ trigger.to_state.attributes.steps * -1 }}'
    target:
      entity_id: light.ceiling_salon
  mode: queued
  max: 10
- id: '1749810838747'
  alias: Zwiększ jasność oświetlenia w salonie
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.shelly_blu_remote_ef9f42_sciemniacz
  conditions:
  - condition: state
    entity_id: sensor.shelly_blu_remote_ef9f42_kanal
    state: '0'
  - condition: state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: event_type
    state: rotate_left
  - condition: numeric_state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: steps
    above: 0
  actions:
  - action: light.turn_on
    metadata: {}
    data:
      brightness_step_pct: '{{ trigger.to_state.attributes.steps }}'
    target:
      entity_id: light.ceiling_salon
  mode: queued
  max: 10
- id: '1749818185808'
  alias: Zwiększ prędkość wentylatora w salonie
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.shelly_blu_remote_ef9f42_sciemniacz
  conditions:
  - condition: state
    entity_id: sensor.shelly_blu_remote_ef9f42_kanal
    state: '2'
  - condition: state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: event_type
    state: rotate_left
  - condition: numeric_state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: steps
    above: 0
  actions:
  - action: fan.turn_on
    metadata: {}
    data:
      percentage: '{{ 33 if state_attr(''fan.ceiling_salon'', ''percentage'') == 0
        else (66 if state_attr(''fan.ceiling_salon'', ''percentage'') == 33 else 100)
        }}'
    target:
      entity_id: fan.ceiling_salon
  mode: queued
  max: 10
- id: '1749818285746'
  alias: Zmniejsz prędkość wentylatora w salonie
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.shelly_blu_remote_ef9f42_sciemniacz
  conditions:
  - condition: state
    entity_id: sensor.shelly_blu_remote_ef9f42_kanal
    state: '2'
  - condition: state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: event_type
    state: rotate_right
  - condition: numeric_state
    entity_id: event.shelly_blu_remote_ef9f42_sciemniacz
    attribute: steps
    above: 0
  actions:
  - action: fan.turn_on
    metadata: {}
    data:
      percentage: '{{ 66 if state_attr(''fan.ceiling_salon'', ''percentage'') == 100
        else (33 if state_attr(''fan.ceiling_salon'', ''percentage'') == 66 else 0)
        }}'
    target:
      entity_id: fan.ceiling_salon
  mode: queued
  max: 10
- id: '1749821871556'
  alias: Zmień kanał TV na następny
  description: ''
  triggers:
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_2
    subtype: press
    trigger: device
  conditions:
  - condition: state
    entity_id: sensor.shelly_blu_remote_ef9f42_kanal
    state: '3'
  actions:
  - action: remote.send_command
    target:
      entity_id: remote.salon
    data:
      device: Dekoder
      command: ChannelUp
  mode: single
- id: '1749822126826'
  alias: Zmień kanał TV na poprzedni
  description: ''
  triggers:
  - device_id: 9d5b0393cd51580b06910ad9ff1cbc8d
    domain: bthome
    type: button_1
    subtype: press
    trigger: device
  conditions:
  - condition: state
    entity_id: sensor.shelly_blu_remote_ef9f42_kanal
    state: '3'
  actions:
  - action: remote.send_command
    target:
      entity_id: remote.salon
    data:
      device: Dekoder
      command: ChannelDown
  mode: single
- id: '1750685194255'
  alias: Nieprawidłowy adres IP urządzenia z VLAN
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - device_tracker.lenovo_thinkpad_t14
    - device_tracker.hp_elitebook_840_g10
    from: not_home
    to: home
  conditions: []
  actions:
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - condition: template
    value_template: '{{ trigger.to_state.attributes.get("vlan") != 8 }}'
  - action: python_script.notify
    data:
      title: Urządzenie opuściło swój VLAN
      message: Urządzenie {{ trigger.to_state.attributes["friendly_name"] }} opóściło
        VLAN 8. Sprawdź poprawność konfiguracji punktów dostępowych Wi-Fi.
      tag: wifi-vlan-wrong-vlan
      priority: high
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
  mode: parallel
  max: 10
- id: '1754039875139'
  alias: Wyłącz zasilanie dekodera TV
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.away_mode
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 20
      seconds: 0
  - trigger: time
    at: 01:00:00
  conditions:
  - condition: state
    entity_id: light.ledy_w_salonie
    state: 'off'
  - condition: state
    entity_id: light.ceiling_salon
    state: 'off'
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.blitzwolf_bw_shp6_ed007d_przeka_nik
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.philips_65oled707
        state: 'off'
    then:
    - action: media_player.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: media_player.philips_65oled707
  mode: single
- id: '1754039992327'
  alias: Włącz zasilanie dekodera TV
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.away_mode
    from: 'on'
    to: 'off'
  - trigger: time
    at: 06:00:00
  conditions: []
  actions:
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: switch.blitzwolf_bw_shp6_ed007d_przeka_nik
  mode: single
- id: '1755021357467'
  alias: Wysokie obciążenie procesora
  description: ''
  triggers:
  - entity_id:
    - sensor.intel_nuc_obciazenie_procesora
    above: 70
    for:
      hours: 0
      minutes: 20
      seconds: 0
    trigger: numeric_state
  conditions: []
  actions:
  - data:
      title: Wysokie obciążenie procesora
      message: Obciążenie procesora serwera Home Assistant wynosi obecnie {{ trigger.to_state.state
        }}%.
      tag: high-cpu-usage
      group: server
      priority: high
      services:
      - service: notify.mobile_app_iphone_13
        type: ios
    action: python_script.notify
  mode: single
